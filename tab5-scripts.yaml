
script:
  - id: expand_nav_btn_click_area
    # Expand the clickable area for the main navigation buttons so
    # that touches near the icons are also registered. This improves
    # usability of the side navigation rail on small touch targets.
    then:
      - lambda: |-
          std::vector<lv_obj_t*> btns = {
            id(dash_panel_btn),
            id(light_panel_btn)
          };
          for (auto* btn : btns) {
            lv_obj_set_ext_click_area(btn, 180);
          }
  - id: nav_rail_update
    # Update the navigation rail UI to reflect the current page
    # selection. This sets the checked state on the correct nav button,
    # updates the icon to the active/inactive glyph, and applies the
    # appropriate label style (active/inactive color).
    then:
      - lambda: |-
          const int active = id(page_num);
          lv_obj_t* buttons[] = { 
              id(dash_panel_btn), 
              id(light_panel_btn), 
          };
          lv_obj_t* icons[] = { 
              id(dash_btn_icon), 
              id(light_btn_icon), 
          };
          lv_obj_t* labels[] = { 
              id(dash_btn_label), 
              id(light_btn_label), 
          };
          const char* icon_unchecked[] = {
              "\U000F0A1D", // dashboard-outline
              "\U000F0336", // lightbulb-outline
          };
          const char* icon_checked[] = {
              "\U000F056E", // dashboard
              "\U000F0335", // lightbulb
          };

          const int count = sizeof(buttons) / sizeof(buttons[0]);
          
          // Update button UI
          for (int i = 0; i < count; i++) {
              if (i == id(page_num)) {
                lv_obj_add_state(buttons[i], LV_STATE_CHECKED);
              } else {
                lv_obj_clear_state(buttons[i], LV_STATE_CHECKED);
              }
              bool selected = (i == active);
              lv_obj_add_style(labels[i], selected ? id(nav_label_activate) : id(nav_label_inactivate), LV_PART_MAIN);
              lv_label_set_text(icons[i], selected ? icon_checked[i] : icon_unchecked[i]);
          }
    
  # The below script was used to sync home assistant
  # entity states with our LVGL UI when UI is drawn on screen.
  - id: sync_ha
    then:
      - logger.log: "Sync with Home Assistant"