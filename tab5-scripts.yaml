
script:
  - id: expand_nav_btn_click_area
    # Expand the clickable area for the main navigation buttons so
    # that touches near the icons are also registered. This improves
    # usability of the side navigation rail on small touch targets.
    then:
      - lambda: |-
          std::vector<lv_obj_t*> btns = {
            id(dash_panel_btn),
            id(climate_panel_btn),
            id(light_panel_btn)
          };
          for (auto* btn : btns) {
            lv_obj_set_ext_click_area(btn, 180);
          }
  - id: nav_rail_update
    # Update the navigation rail UI to reflect the current page
    # selection. This sets the checked state on the correct nav button,
    # updates the icon to the active/inactive glyph, and applies the
    # appropriate label style (active/inactive color).
    then:
      - lambda: |-
          const int active = id(page_num);
          lv_obj_t* buttons[] = { 
              id(dash_panel_btn), 
              id(light_panel_btn), 
              id(climate_panel_btn), 
          };
          lv_obj_t* icons[] = { 
              id(dash_btn_icon), 
              id(light_btn_icon), 
              id(climate_btn_icon), 
          };
          lv_obj_t* labels[] = { 
              id(dash_btn_label), 
              id(light_btn_label), 
              id(climate_btn_label), 
          };
          const char* icon_unchecked[] = {
              "\U000F0A1D", // dashboard-outline
              "\U000F0336", // lightbulb-outline
              "\U000F0F55", // thermometer
          };
          const char* icon_checked[] = {
              "\U000F056E", // dashboard
              "\U000F0335", // lightbulb
              "\U000F0F54", // thermometer
          };

          const int count = sizeof(buttons) / sizeof(buttons[0]);
          
          // Update button UI
          for (int i = 0; i < count; i++) {
              if (i == id(page_num)) {
                lv_obj_add_state(buttons[i], LV_STATE_CHECKED);
              } else {
                lv_obj_clear_state(buttons[i], LV_STATE_CHECKED);
              }
              bool selected = (i == active);
              lv_obj_add_style(labels[i], selected ? id(nav_label_activate) : id(nav_label_inactivate), LV_PART_MAIN);
              lv_label_set_text(icons[i], selected ? icon_checked[i] : icon_unchecked[i]);
          }
    
  # The below script was used to sync home assistant
  # entity states with our LVGL UI when UI is drawn on screen.
  - id: sync_ha
    then:
      - logger.log: "Sync with Home Assistant"

  - id: update_arc_color
    parameters:
      ac_mode_index: int
    then:
      - lambda: |-
          switch ( ac_mode_index ) {
            /* Heat/Cool */
            case 0:
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xFAE19D), LV_PART_MAIN);
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xFAE19D), LV_PART_INDICATOR);
              lv_obj_set_style_outline_color(id(ac_arc), lv_color_hex(0xF5C23B), LV_PART_KNOB);
              break;
            /* Heat */
            case 1:
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xEBEBEB), LV_PART_MAIN);
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xEC7636), LV_PART_INDICATOR);
              lv_obj_set_style_outline_color(id(ac_arc), lv_color_hex(0xEC7636), LV_PART_KNOB);
              break;
            /* Cool */
            case 2:
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0x4C96EE), LV_PART_MAIN);
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xEBEBEB), LV_PART_INDICATOR);
              lv_obj_set_style_outline_color(id(ac_arc), lv_color_hex(0x4C96EE), LV_PART_KNOB);
              break;
            /* Dry */
            case 3:
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xF7CD98), LV_PART_MAIN);
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xF7CD98), LV_PART_INDICATOR);
              lv_obj_set_style_outline_color(id(ac_arc), lv_color_hex(0xF09C31), LV_PART_KNOB);
              break;
            /* Fan */
            case 4:
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xABDDE8), LV_PART_MAIN);
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xABDDE8), LV_PART_INDICATOR);
              lv_obj_set_style_outline_color(id(ac_arc), lv_color_hex(0x58BAD2), LV_PART_KNOB);
              break;
            /* Off */
            case 5:
            /* fallthrough */
            default:
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xEBEBEB), LV_PART_MAIN);
              lv_obj_set_style_arc_color(id(ac_arc), lv_color_hex(0xEBEBEB), LV_PART_INDICATOR);
              lv_obj_set_style_outline_color(id(ac_arc), lv_color_hex(0x9E9E9E), LV_PART_KNOB);
              break;
          }
  # This script was used on dropdown widget
  # to set ac state (ON/OFF/COOL/HEAT, etc)
  - id: set_ac_state
    parameters:
      ac_mode_idx: int
    then:
      - homeassistant.action:
          action: climate.set_hvac_mode
          data:
            entity_id: climate.air_conditioner
            hvac_mode: !lambda return id(hvac_state_table)[ac_mode_idx];
  - id: set_ac_fan_mode
    parameters:
      ac_fan_mode_idx: int
    then:
      - homeassistant.action:
          action: climate.set_fan_mode
          data:
            entity_id: climate.air_conditioner
            fan_mode: !lambda return id(fan_modes_table)[ac_fan_mode_idx];
  # This script was used on spinbox/arc widget
  # to set the temperature to climate entity
  # it doesn't turn on/off, use the dropdown instead
  - id: set_ac_temp
    parameters:
      temp_value: float
    then:
      - homeassistant.action:
          action: climate.set_temperature
          data:
            entity_id: climate.air_conditioner
            temperature: !lambda return temp_value;
